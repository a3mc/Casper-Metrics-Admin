<div *ngIf="user.id">
    <h5>{{ user.firstName }} {{ user.lastName }}</h5>
    <div>{{ user.email }}</div>
    <div *ngIf="user.id === authService.user.id" class="mt-1">
        <i>{{ user.role }}</i>
    </div>
    <div *ngIf="user.deleted" class="text-danger mt-1">
        DELETED ACCOUNT
    </div>
</div>

<form (submit)="save()" class="form sign-in-form" [formGroup]="userForm"
      *ngIf="!user.deleted && user.id !== authService.user.id">

    <div *ngIf="showSuccess" class="form-group alert alert-success success-message mb-3">
        Saved successfully.
    </div>

    <div *ngIf="errorMessage" class="form-group alert alert-danger error-message mb-3">
        {{ errorMessage }}
    </div>

    <div class="form-group" *ngIf="!user.id">
        <label for="userEmail">Email</label>
        <input formControlName="UserEmail" id="userEmail" maxlength="128" [email]="true"
               class="form-control" required type="email" name="email"
               [class.is-invalid]="userForm.controls.UserEmail.touched && userForm.controls.UserEmail.invalid">
    </div>

    <div class="form-group" *ngIf="!user.id">
        <label for="firstName" class="mt-3">First Name</label>
        <input formControlName="FirstName" id="firstName" minlength="1" maxlength="128"
               class="form-control" required name="firstName"
               pattern="[a-zA-Z ]*"
               [class.is-invalid]="userForm.controls.FirstName.touched && userForm.controls.FirstName.invalid">
    </div>

    <div class="form-group" *ngIf="!user.id">
        <label for="lastName" class="mt-3">Last Name</label>
        <input formControlName="LastName" id="lastName" minlength="1" maxlength="128"
               class="form-control" required name="lastName"
               pattern="[a-zA-Z ]*"
               [class.is-invalid]="userForm.controls.LastName.touched && userForm.controls.LastName.invalid">
    </div>

    <div class="form-group" *ngIf="user.id && user.active">
        <label for="role" class="mt-3">Role</label>
        <select formControlName="Role" id="role"
               class="form-control" required name="role"
               [class.is-invalid]="userForm.controls.Role.touched && userForm.controls.Role.invalid">
            <option *ngFor="let role of roles" [value]="role">{{ role }}</option>
        </select>
    </div>

    <div class="form-group mt-3" *ngIf="user.id && user.active">
        <button class="btn btn-success"
                [class.btn-warning]="userForm.invalid"
                [disabled]="userForm.invalid"
                type="submit">Save</button>
    </div>

    <div class="form-group mt-5" *ngIf="user.id">
        <button class="btn btn-sm btn-warning"
                (click)="confirmReset()"
                type="button">Reset password &amp; 2FA</button>

        <div>
            <small class="text-muted">User will receive a new activation link. Role will be set to "Viewer".</small>
        </div>
    </div>

    <div class="form-group mt-5" *ngIf="user.id">
        <button class="btn btn-sm btn-danger"
                (click)="confirmDeactivate()"
                type="button">Deactivate user account permanently</button>

        <div>
            <small class="text-muted">Logs related to the user will remain.</small>
        </div>
    </div>

    <div class="form-group mt-3" *ngIf="!user.id">
        <button class="btn btn-success"
                [class.btn-warning]="userForm.invalid"
                [disabled]="userForm.invalid"
                type="submit">Send Invitation Link</button>

        <div class="text-muted text-small mt-2">
            <i>Link expires in 24h.</i>
        </div>
    </div>
</form>
